import{TAGS_QUERY,getSearchQueryFromUrl,getPageNumFromUrl,getTagsQueryFromUrl,gotoPageNumber}from"/static/global.js";import{fetchSnippets}from"/static/search.js";const RESULTS_PER_PAGE=16,QUERY_BANNER_SELECTOR="#query-banner",SNIPPET_CARD_SELECTOR=".snippet-card",SNIPPET_LOADING_CLASS="is-loading",SNIPPET_THUMBNAIL_SELECTOR=".snippet-card-thumbnail",SNIPPET_IMG_SELECTOR=".snippet-card-thumbnail img",SNIPPET_TITLE_SELECTOR=".snippet-card-title",SNIPPET_TITLE_DIV_SELECTOR=".snippet-card-title div",SNIPPET_TAG_CONTAINER_SELECTOR=".snippet-card-tags",SNIPPET_TAG_CLASS="tag",PAGINATION_BAR_SELECTOR="#pagination",PAGINATION_PREV_BTN_SELECTOR=".pagination-prev",PAGINATION_PAGE_1_SELECTOR=".pagination-item:nth-of-type(2)",PAGINATION_START_DOTS_SELECTOR=".pagination-dots:nth-of-type(1)",PAGINATION_PAGE_4_SELECTOR=".pagination-item:nth-of-type(3)",PAGINATION_PAGE_5_SELECTOR=".pagination-item:nth-of-type(4)",PAGINATION_ACTIVE_BTN_SELECTOR=".pagination-active",PAGINATION_PAGE_7_SELECTOR=".pagination-item:nth-of-type(6)",PAGINATION_PAGE_8_SELECTOR=".pagination-item:nth-of-type(7)",PAGINATION_END_DOTS_SELECTOR=".pagination-dots:nth-of-type(2)",PAGINATION_PAGE_11_SELECTOR=".pagination-item:nth-of-type(8)",PAGINATION_NEXT_BTN_SELECTOR=".pagination-next";function setupPaginationBtns(currentIndex,totalIndices){let paginationBar=document.querySelector(PAGINATION_BAR_SELECTOR);paginationBar.style.display="";let prevBtn=paginationBar.querySelector(PAGINATION_PREV_BTN_SELECTOR),page1=paginationBar.querySelector(PAGINATION_PAGE_1_SELECTOR),startDots=paginationBar.querySelector(PAGINATION_START_DOTS_SELECTOR),page4=paginationBar.querySelector(PAGINATION_PAGE_4_SELECTOR),page5=paginationBar.querySelector(PAGINATION_PAGE_5_SELECTOR),pageActiveBtn=paginationBar.querySelector(PAGINATION_ACTIVE_BTN_SELECTOR),page7=paginationBar.querySelector(PAGINATION_PAGE_7_SELECTOR),page8=paginationBar.querySelector(PAGINATION_PAGE_8_SELECTOR),endDots=paginationBar.querySelector(PAGINATION_END_DOTS_SELECTOR),page11=paginationBar.querySelector(PAGINATION_PAGE_11_SELECTOR),nextBtn=paginationBar.querySelector(PAGINATION_NEXT_BTN_SELECTOR),toShowPrev=currentIndex!=1;prevBtn.style.display=toShowPrev?"":"none",prevBtn.onclick=toShowPrev?()=>{gotoPageNumber(currentIndex-1)}:null;let toShowPage1=4<=currentIndex;page1.style.display=toShowPage1?"":"none",page1.onclick=toShowPage1?()=>{gotoPageNumber(1)}:null,page1.textContent=toShowPage1?1:"-";let toShowStartDots=5<=currentIndex;startDots.style.display=toShowStartDots?"":"none";let toShowPage4=3<=currentIndex;page4.style.display=toShowPage4?"":"none",page4.onclick=toShowPage4?()=>{gotoPageNumber(currentIndex-2)}:null,page4.textContent=toShowPage4?currentIndex-2:"-";let toShowPage5=2<=currentIndex;page5.style.display=toShowPage5?"":"none",page5.onclick=toShowPage5?()=>{gotoPageNumber(currentIndex-1)}:null,page5.textContent=toShowPage5?currentIndex-1:"-",pageActiveBtn.textContent=currentIndex;let toShowPage7=totalIndices>=currentIndex+1;page7.style.display=toShowPage7?"":"none",page7.onclick=toShowPage7?()=>{gotoPageNumber(currentIndex+1)}:null,page7.textContent=toShowPage7?currentIndex+1:"-";let toShowPage8=totalIndices>=currentIndex+2;page8.style.display=toShowPage8?"":"none",page8.onclick=toShowPage8?()=>{gotoPageNumber(currentIndex+2)}:null,page8.textContent=toShowPage8?currentIndex+2:"-";let toShowEndDots=currentIndex<totalIndices-3;endDots.style.display=toShowEndDots?"":"none";let toShowPage11=currentIndex<totalIndices-2;page11.style.display=toShowPage11?"":"none",page11.onclick=toShowPage11?()=>{gotoPageNumber(totalIndices)}:null,page11.textContent=toShowPage11?totalIndices:"-";let toShowNext=currentIndex!=totalIndices;nextBtn.style.display=toShowNext?"":"none",nextBtn.onclick=toShowNext?()=>{gotoPageNumber(currentIndex+1)}:null}function assignQueryBanner(resultCount=0,queries={}){if(!queries.searchQuery&&queries.tags.length==0)return;let queryBannerElement=document.querySelector(QUERY_BANNER_SELECTOR);if(!queryBannerElement)return;queryBannerElement.style.display="";let queryText=`${resultCount} ${resultCount==1?"result":"results"}`;queryText+=queries.searchQuery?` for "${queries.searchQuery}"`:"",queryText+=queries.tags.length!=0?` with ${queries.tags.length==1?"tag":"tags"} ${queries.tags.map(i=>`[ ${i} ]`).join(" ")}`:"",queryBannerElement.textContent=queryText}function updateSnippetCards(snippets){const snippetCards=document.querySelectorAll(SNIPPET_CARD_SELECTOR);for(let i=0;i<snippetCards.length;i++){const card=snippetCards[i];if(card.classList.remove(SNIPPET_LOADING_CLASS),snippets.length<=i){card.style.display="none";continue}let imgElement=card.querySelector(SNIPPET_IMG_SELECTOR),thumbnail=snippets[i]?.thumbnail;const imgUrl=thumbnail?new URL(thumbnail,window.location.origin+snippets[i]?.url).href:"";imgElement.src=imgUrl;let thumbnailElement=card.querySelector(SNIPPET_THUMBNAIL_SELECTOR);thumbnailElement.href=snippets[i]?.url,thumbnailElement.style.display=thumbnail?"":"none";let titleDivElement=card.querySelector(SNIPPET_TITLE_DIV_SELECTOR);titleDivElement.textContent=snippets[i]?.title;let titleElement=card.querySelector(SNIPPET_TITLE_SELECTOR);titleElement.href=snippets[i]?.url,titleElement.classList.remove(SNIPPET_LOADING_CLASS);let tagContainer=card.querySelector(SNIPPET_TAG_CONTAINER_SELECTOR);for(tagContainer.classList.remove(SNIPPET_LOADING_CLASS);tagContainer.firstChild;)tagContainer.removeChild(tagContainer.firstChild);let tags=snippets[i]?.tags??[];for(let i2=0;i2<tags.length;i2++){if(tags[i2]=="")continue;const tagElement=document.createElement("a");tagElement.href=`/?${TAGS_QUERY}=${encodeURIComponent(tags[i2])}`,tagElement.className=SNIPPET_TAG_CLASS,tagElement.textContent=tags[i2],tagContainer.appendChild(tagElement)}}}async function main(){const urlQueries={searchQuery:getSearchQueryFromUrl(),pageNumber:getPageNumFromUrl(),tags:getTagsQueryFromUrl()};assignQueryBanner("Loading",urlQueries);const{snippets,totalSnippets}=await fetchSnippets(urlQueries.searchQuery,urlQueries.tags,RESULTS_PER_PAGE,RESULTS_PER_PAGE*(urlQueries.pageNumber-1));if(assignQueryBanner(totalSnippets,urlQueries),updateSnippetCards(snippets),RESULTS_PER_PAGE<totalSnippets){const totalPages=0<totalSnippets?Math.ceil(totalSnippets/RESULTS_PER_PAGE):1;setupPaginationBtns(urlQueries.pageNumber,totalPages)}}main();
